<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Analysis of vzlom_vk (Failed) - Brian Stadnicki</title><meta name=Description content><meta property="og:title" content="Analysis of vzlom_vk (Failed)"><meta property="og:description" content="Malware obtained from any.run. It&rsquo;s an unknown executable which unpacks itself, fails to run update.exe and prints out some russian.
Property Value MD5 18b065e37c55a00d7a023f5cef02bde4 SHA1 fb6e6596c617f932cd9c7740b29ed6f5dda8a88c SHA256 bc4896abbf0726df8b9ef9134d584bbe1b649f59e453bbc327f8cd5b5b5a0651 File Type Portable Executable 32 File Info Microsoft Visual C++ 8 First run When run, it prints out the following text:
The system cannot find the file update.exe ﻿Вас приветствует программа взлома ВК аккаунтов! Благодарим за приобретение лицензии нашей программы! Вы уверенны, что хотите начать?"><meta property="og:type" content="article"><meta property="og:url" content="https://brianstadnicki.github.io/posts/malware-vzlom-vk/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-09T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-09T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Analysis of vzlom_vk (Failed)"><meta name=twitter:description content="Malware obtained from any.run. It&rsquo;s an unknown executable which unpacks itself, fails to run update.exe and prints out some russian.
Property Value MD5 18b065e37c55a00d7a023f5cef02bde4 SHA1 fb6e6596c617f932cd9c7740b29ed6f5dda8a88c SHA256 bc4896abbf0726df8b9ef9134d584bbe1b649f59e453bbc327f8cd5b5b5a0651 File Type Portable Executable 32 File Info Microsoft Visual C++ 8 First run When run, it prints out the following text:
The system cannot find the file update.exe ﻿Вас приветствует программа взлома ВК аккаунтов! Благодарим за приобретение лицензии нашей программы! Вы уверенны, что хотите начать?"><meta name=application-name content="Brian Stadnicki"><meta name=apple-mobile-web-app-title content="Brian Stadnicki"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://brianstadnicki.github.io/posts/malware-vzlom-vk/><link rel=prev href=https://brianstadnicki.github.io/posts/crackmes-marquier-crackme-v4-marquire/><link rel=next href=https://brianstadnicki.github.io/posts/crackmes-rendariaka-packedcrackmev1-0/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Analysis of vzlom_vk (Failed)","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/brianstadnicki.github.io\/posts\/malware-vzlom-vk\/"},"genre":"posts","keywords":"reverse engineering, malware, russian, x86, python","wordcount":778,"url":"https:\/\/brianstadnicki.github.io\/posts\/malware-vzlom-vk\/","datePublished":"2021-11-09T00:00:00+00:00","dateModified":"2021-11-09T00:00:00+00:00","publisher":{"@type":"Organization","name":"Brian Stadnicki"},"author":{"@type":"Person","name":"Brian Stadnicki"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":""==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:""==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/canopy/dev/>Canopy </a><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/canopy/dev/ title>Canopy</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Analysis of vzlom_vk (Failed)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Brian Stadnicki</a></span>&nbsp;<span class=post-category>included in <a href=/categories/malware/><i class="far fa-folder fa-fw"></i>malware</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-11-09>2021-11-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;778 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#first-run>First run</a></li><li><a href=#unpacking>Unpacking</a></li><li><a href=#dumped-executable-initial-analysis>Dumped executable initial analysis</a></li><li><a href=#files-dynamically-written>Files dynamically written</a></li><li><a href=#python-extraction>Python extraction</a></li><li><a href=#pyinstaller>PyInstaller</a></li><li><a href=#pyinstaller-files>PyInstaller files</a></li><li><a href=#failure>Failure</a></li></ul></nav></div></div><div class=content id=content><p>Malware obtained from <a href=https://app.any.run/tasks/75439b32-753f-4d1c-b4d3-ee36a4605de1/ target=_blank rel="noopener noreffer">any.run</a>. It&rsquo;s an unknown executable which unpacks itself, fails to run <code>update.exe</code> and prints out some russian.</p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>MD5</td><td>18b065e37c55a00d7a023f5cef02bde4</td></tr><tr><td>SHA1</td><td>fb6e6596c617f932cd9c7740b29ed6f5dda8a88c</td></tr><tr><td>SHA256</td><td>bc4896abbf0726df8b9ef9134d584bbe1b649f59e453bbc327f8cd5b5b5a0651</td></tr><tr><td>File Type</td><td>Portable Executable 32</td></tr><tr><td>File Info</td><td>Microsoft Visual C++ 8</td></tr></tbody></table><h2 id=first-run>First run</h2><p>When run, it prints out the following text:</p><pre tabindex=0><code>The system cannot find the file update.exe
﻿Вас приветствует программа взлома ВК аккаунтов!
Благодарим за приобретение лицензии нашей программы!
Вы уверенны, что хотите начать? (да/нет):
</code></pre><p>Using the trusty google translator, that turns into:</p><pre tabindex=0><code>You are welcomed by the program for hacking VK accounts!
Thank you for purchasing our software license!
Are you sure you want to start? (yes / no):
</code></pre><p>This appears to be a tool for hacking <a href=https://vk.com/ target=_blank rel="noopener noreffer">VK</a> accounts, which is &ldquo;the largest social network in Russia and the CIS&rdquo;. This is also a cracked version, seeing how I definitely don&rsquo;t own a license.</p><p>When I enter <code>y</code>, the following shows up:</p><pre tabindex=0><code>Введите id жертвы:
</code></pre><p>Translated, that means:</p><pre tabindex=0><code>Enter victim id:
</code></pre><p>So, here is a hacking tool for VK accounts and it asks for a victim ID, now who do I not like in Russia&mldr; I&rsquo;ll just put 0.</p><p>Now it prints out</p><pre tabindex=0><code>Загрузка...
</code></pre><p>which means</p><pre tabindex=0><code>Loading...
</code></pre><p>Next is a progress bar, which gets up to 25%, followed by a python error:</p><pre tabindex=0><code>Traceback (most recent call last):
  File &#34;vzlom_vk.py&#34;, line 21, in &lt;module&gt;
FileNotFoundError: [WinError 2] The system cannot find the file specified &#39;update.exe&#39;
[1548] Failed to execute script vzlom_vk
</code></pre><p>Later I&rsquo;ll focuse on trying to extracting this python script.</p><h2 id=unpacking>Unpacking</h2><p>Detect It Easy provides very useful information about how the executable is packed:</p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>Protector</td><td>ENIGMA(4.0 build 2020.5.17 10:10:13)[-]</td></tr><tr><td>Linker</td><td>Microsoft Linker(8.0*)[Console32,console]</td></tr><tr><td>Overlay</td><td>zlib archive(-)[-]</td></tr></tbody></table><p>To dump this, I will quite simply run the malware and use <a href=https://github.com/glmcdona/Process-Dump target=_blank rel="noopener noreffer">Process Dump</a>, pointing it to the process ID of the child of the malware.</p><h2 id=dumped-executable-initial-analysis>Dumped executable initial analysis</h2><p>Just from looking at strings, there are multiple things we can infer:</p><table><thead><tr><th>String</th><th>Inference</th></tr></thead><tbody><tr><td>Py_*</td><td>Python C api used</td></tr><tr><td>inflate 1.2.11 Copyright 1995-2017 Mark Adler</td><td>Zlib compression used</td></tr><tr><td>Fls*</td><td>Fiber Local Storage (FLS) used</td></tr><tr><td>Software\Borland\Delphi\RTL</td><td>Delphi (Locales) used</td></tr><tr><td>RIJNDAEL</td><td>AES encryption used</td></tr><tr><td>Yarrow has not been reseeded</td><td>Yarrow pseudorandom number generator used</td></tr><tr><td>EP_*</td><td>Engima Protector keys are validated</td></tr><tr><td>9iCCPPhotoshop ICC profile</td><td>Photoshop colour profiles are referenced</td></tr><tr><td>IEUser MSEDGEWIN10</td><td>Dumps are fingerprinted</td></tr></tbody></table><p>It&rsquo;s very likely that most of these details are related to the ENIGMA packer.</p><h2 id=files-dynamically-written>Files dynamically written</h2><p>The unpacked exe extracts resources into <code>C:\Users\IEUser\AppData\Local\Temp\_MEI5562</code>, where there are: python extension modules, library dlls, locale files and tkinter. However, the script <code>vzlom_vk.py</code> is missing.</p><p>Near the end of the procmon log, I find the following entry:</p><p><code>vzlom_vk.exe 994 CreateFile C:\Users\IEUser\AppData\Local\Temp\_MEI5562\vzlom_vk.py</code></p><p>However, this file is never written to, therefore this is not in fact the location of the python script, but rather the location the python process thinks its at because in reality the script was loaded in dynamically through the python C api.</p><h2 id=python-extraction>Python extraction</h2><p>Based off the python C api <a href=https://docs.python.org/3/c-api target=_blank rel="noopener noreffer">documentation</a>, the following used methods are of interest for finding the code which is dynamically executed:</p><ul><li><a href=https://docs.python.org/3/c-api/veryhigh.html#c.PyEval_EvalCode target=_blank rel="noopener noreffer">PyEval_EvalCode</a></li><li><a href=https://docs.python.org/3/c-api/call.html#c.PyObject_Call target=_blank rel="noopener noreffer">PyObject_CallFunction</a></li><li><a href="https://docs.python.org/3/c-api/import.html?highlight=pyimport_execcodemodule#c.PyImport_ExecCodeModule" target=_blank rel="noopener noreffer">PyImport_ExecCodeModule</a></li><li><a href="https://docs.python.org/3/c-api/sys.html?highlight=pysys_setpath#c.PySys_SetPath" target=_blank rel="noopener noreffer">PySys_SetPath</a></li></ul><p>All of these imports are referenced at least once in the same function.</p><pre tabindex=0><code>0x1032900:

       +------+
       |Import|
       +-+--+-+
         |  |
+------+ |  | +-------+
| Fail &lt;-+  +-+&gt;Import|
+------+      +--+--+-+
                 |  |
        +------+ |  | +------+
        | Fail &lt;-+  +-&gt;Import|
        +------+      +-+--+-+
                        |  |
               +------+ |  | +------+
               | Fail &lt;-+  +-&gt;Import|
               +------+      +-+--+-+
                               |  |
                      +------+ |  | +------+
                      | Fail &lt;-+  +-&gt;Import|
                      +------+      +-+--+-+
                                      |  |
                             +------+ |  | +------+
                             | Fail &lt;-+  +-&gt;Import|
                             +------+      +-+--+-+
                                             |  |
                                    +------+ |  | +-------+
                                    | Fail &lt;-+  +-+&gt;Import|
                                    +------+      +--+--+-+
                                                     |  |
                                            +------+ |  |
                                            | Fail &lt;-+  +-&gt;.......
                                            +------+
</code></pre><p>This function simply populates all of the python imports.</p><p>Here are the xrefs to <code>PyEval_EvalCode</code>:</p><table><thead><tr><th>Type</th><th>Address</th><th>Text</th></tr></thead><tbody><tr><td>r</td><td>python_executor+160</td><td>call ds:PyEval_EvalCode</td></tr><tr><td>w</td><td>get_python_imports+4DB</td><td>mov ds:PyEval_EvalCode, eax</td></tr><tr><td>o</td><td>.nicuew:013F3420</td><td>dd rva PyEval_EvalCode; Import Address Table</td></tr></tbody></table><p>Based off this, we can identify that <code>python_executor</code> is responsible for python code calling at least partially.</p><h2 id=pyinstaller>PyInstaller</h2><p>I spotted the string <code>_MEIPASS2</code>, which after some googling turns out is an environment variable for PyInstaller. Therefore, let&rsquo;s see if this can be extracted using the <a href=https://github.com/extremecoders-re/pyinstxtractor target=_blank rel="noopener noreffer">PyInstaller Extractor</a></p><pre tabindex=0><code>struct.error: unpack requires a buffer of 4 bytes
</code></pre><p>Always worthy a try to use pre-existing tools, even if they don&rsquo;t often work out.</p><h2 id=pyinstaller-files>PyInstaller files</h2><p>Let&rsquo;s take a look again at the files which were dynamically written.</p><p>The <code>.pyd</code> files are simply dlls.</p><h2 id=failure>Failure</h2><p>I ran <code>strings</code> to try to find where <code>__main__</code> could possibly be. Debugging didn&rsquo;t reveal what the script actually is. Python dumpers don&rsquo;t seem to exist.</p><p>Therefore, until I learn more about python reverse engineering through more reverse engineering, this project will be put on hold.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-11-09</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/reverse-engineering/>reverse engineering</a>,&nbsp;<a href=/tags/malware/>malware</a>,&nbsp;<a href=/tags/russian/>russian</a>,&nbsp;<a href=/tags/x86/>x86</a>,&nbsp;<a href=/tags/python/>python</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/crackmes-marquier-crackme-v4-marquire/ class=prev rel=prev title="Cracking Marquire's CrackMe_V4_Marquire"><i class="fas fa-angle-left fa-fw"></i>Cracking Marquire's CrackMe_V4_Marquire</a>
<a href=/posts/crackmes-rendariaka-packedcrackmev1-0/ class=next rel=next title="Cracking rendariaka's packedcrackmev1.0">Cracking rendariaka's packedcrackmev1.0<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "f5dd1cc794e748f0a1fa431f62434694"}'></script></body></html>