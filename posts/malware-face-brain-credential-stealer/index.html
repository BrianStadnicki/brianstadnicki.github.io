<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' utteranc.es; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' utteranc.es static.cloudflareinsights.com; prefetch-src 'self'; connect-src 'self' cloudflareinsights.com;">
<meta name=author content="Brian Stadnicki">
<meta name=description content="Today I&rsquo;m taking a look at a password stealer filled with obfuscation and some virtual machine detection. The sample can be obtained from malshare, with an automated analysis report on joesandbox.
   Property Value     File Type Portable Executable 64   File Size 3.69 MB   CompanyName Say celebrate Date   FileDescription Dress Suffer fuel basic   FileVersion 6.4.14.15   LegalCopyright Pine Shit (c) 2005   ProductName Almost publication   MD5 3c7c6d236721ea4cef0f904ebde6f575   SHA1 d82cd631a49a175caace0fb209f7b9da16e29655   SHA256 ed107d31ac4a6e8f665986e3326cc2c4551fd00ba26f5414faa8edd0f7c20061    Initial overview    The sandbox report provides us with a lot of useful initial information.">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Face Brain: Password stealer with vm detection">
<meta name=twitter:description content="Today I&rsquo;m taking a look at a password stealer filled with obfuscation and some virtual machine detection. The sample can be obtained from malshare, with an automated analysis report on joesandbox.
   Property Value     File Type Portable Executable 64   File Size 3.69 MB   CompanyName Say celebrate Date   FileDescription Dress Suffer fuel basic   FileVersion 6.4.14.15   LegalCopyright Pine Shit (c) 2005   ProductName Almost publication   MD5 3c7c6d236721ea4cef0f904ebde6f575   SHA1 d82cd631a49a175caace0fb209f7b9da16e29655   SHA256 ed107d31ac4a6e8f665986e3326cc2c4551fd00ba26f5414faa8edd0f7c20061    Initial overview    The sandbox report provides us with a lot of useful initial information.">
<meta property="og:title" content="Face Brain: Password stealer with vm detection">
<meta property="og:description" content="Today I&rsquo;m taking a look at a password stealer filled with obfuscation and some virtual machine detection. The sample can be obtained from malshare, with an automated analysis report on joesandbox.
   Property Value     File Type Portable Executable 64   File Size 3.69 MB   CompanyName Say celebrate Date   FileDescription Dress Suffer fuel basic   FileVersion 6.4.14.15   LegalCopyright Pine Shit (c) 2005   ProductName Almost publication   MD5 3c7c6d236721ea4cef0f904ebde6f575   SHA1 d82cd631a49a175caace0fb209f7b9da16e29655   SHA256 ed107d31ac4a6e8f665986e3326cc2c4551fd00ba26f5414faa8edd0f7c20061    Initial overview    The sandbox report provides us with a lot of useful initial information.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://brianstadnicki.github.io/posts/malware-face-brain-credential-stealer/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-21T00:00:00+00:00">
<meta property="article:modified_time" content="2021-12-21T00:00:00+00:00">
<title>
Face Brain: Password stealer with vm detection · Brian Stadnicki
</title>
<link rel=canonical href=https://brianstadnicki.github.io/posts/malware-face-brain-credential-stealer/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.92.0">
</head>
<body class="preload-transitions colorscheme-light">
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Brian Stadnicki
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/about/>About</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/contact/>Contact me</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://brianstadnicki.github.io/posts/malware-face-brain-credential-stealer/>
Face Brain: Password stealer with vm detection
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-12-21T00:00:00Z>
21 December, 2021
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read
</span>
</div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/malware-analysis/>malware analysis</a></div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/reverse-engineering/>reverse engineering</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/malware/>malware</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/stealer/>stealer</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/anti-vm/>anti-vm</a>
</span></div>
</div>
</header>
<div>
<p><img src=/posts/malware-face-brain-credential-stealer/malware-icon.png alt=Icon></p>
<p>Today I&rsquo;m taking a look at a password stealer filled with obfuscation and some virtual machine detection. The sample can be obtained from <a href="https://malshare.com/sample.php?action=detail&hash=ed107d31ac4a6e8f665986e3326cc2c4551fd00ba26f5414faa8edd0f7c20061">malshare</a>, with an automated analysis report on <a href=https://www.joesandbox.com/analysis/542989/0/html>joesandbox</a>.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Type</td>
<td>Portable Executable 64</td>
</tr>
<tr>
<td>File Size</td>
<td>3.69 MB</td>
</tr>
<tr>
<td>CompanyName</td>
<td>Say celebrate Date</td>
</tr>
<tr>
<td>FileDescription</td>
<td>Dress Suffer fuel basic</td>
</tr>
<tr>
<td>FileVersion</td>
<td>6.4.14.15</td>
</tr>
<tr>
<td>LegalCopyright</td>
<td>Pine Shit (c) 2005</td>
</tr>
<tr>
<td>ProductName</td>
<td>Almost publication</td>
</tr>
<tr>
<td>MD5</td>
<td>3c7c6d236721ea4cef0f904ebde6f575</td>
</tr>
<tr>
<td>SHA1</td>
<td>d82cd631a49a175caace0fb209f7b9da16e29655</td>
</tr>
<tr>
<td>SHA256</td>
<td>ed107d31ac4a6e8f665986e3326cc2c4551fd00ba26f5414faa8edd0f7c20061</td>
</tr>
</tbody>
</table>
<h1 id=initial-overview>
Initial overview
<a class=heading-link href=#initial-overview>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>The sandbox report provides us with a lot of useful initial information. It tells us that it&rsquo;s attempting to steal credentials, and contains anti-analysis techniques such as dummy data, code obfuscation and cpuid.</p>
<p><img src=/posts/malware-face-brain-credential-stealer/joesandbox-signatures.png alt=Signatures></p>
<h1 id=junk-data>
Junk data
<a class=heading-link href=#junk-data>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>There are several techniques used in this sample to evade analysis. For example, there&rsquo;s a lot of dummy base64 strings to annoy me a bit.</p>
<p><img src=/posts/malware-face-brain-credential-stealer/dummy-b64-strings.png alt="Dummy base64 strings"></p>
<p>Among them is the string I used for naming this sample, since it doesn&rsquo;t appear to have a classification.</p>
<p>There&rsquo;s also a lot of general dummy strings.</p>
<p><img src=/posts/malware-face-brain-credential-stealer/dummy-text-strings.png alt="General dummy strings"></p>
<h1 id=initial-run>
Initial run
<a class=heading-link href=#initial-run>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>When I initially ran this, I observed a high CPU usage, probably from whatever it&rsquo;s doing after loading some crypto libraries, followed by the process exiting. That&rsquo;s not my expectation.</p>
<h2 id=work-around>
Work around
<a class=heading-link href=#work-around>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>The sandbox signatures mentioned <code>Contains functionality to query CPU information (cpuid)</code>.</p>
<p><img src=/posts/malware-face-brain-credential-stealer/mentions-cpuid.png alt="204 mentions of cpuid"></p>
<p>There&rsquo;s 204 mentions of <code>cpuid</code>, because this sample is quite heavily obfuscated.</p>
<p>To defeat this anti-vm technique, there&rsquo;s a great post on <a href=https://rayanfam.com/topics/defeating-malware-anti-vm-techniques-cpuid-based-instructions/>Sina & Shahria&rsquo;s Blog</a> about it.</p>
<p>I don&rsquo;t know which registers are being used for this detection, so I&rsquo;ll write over them all:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cpuid.1.rax=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.rbx=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.rcx=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.rdx=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.rex=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r8=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r9=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r10=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r11=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r12=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r13=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r14=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r15=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
cpuid.1.r16=&#34;0---:----:----:----:----:----:----:----:----:----:----:----:----:----:----:----&#34;
</code></pre></div><p>I append this to my vmware virtual machine&rsquo;s .vmx file.</p>
<h1 id=continued-run>
Continued run
<a class=heading-link href=#continued-run>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>Now that the anti-vm detection has been defeated, I can focus on the stealing part itself.</p>
<p>The code is heavily obfuscated, complete spaghetti, so I&rsquo;m not going to bother with a lot of static analysis, simply what&rsquo;s going on in procmon.</p>
<h2 id=data-collected>
Data collected
<a class=heading-link href=#data-collected>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<table>
<thead>
<tr>
<th>Data</th>
<th>Evidence</th>
</tr>
</thead>
<tbody>
<tr>
<td>Computer Name</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-computer-name.png alt></td>
</tr>
<tr>
<td>WinSCP sessions</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-winscp-sessions.png alt></td>
</tr>
<tr>
<td>FileZilla credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-filezilla-credentials.png alt></td>
</tr>
<tr>
<td>Firefox credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-firefox-credentials.png alt></td>
</tr>
<tr>
<td>Microsoft Edge credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-microsoft-edge-credentials.png alt></td>
</tr>
<tr>
<td>Yandex browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-yandex-browser-credentials.png alt></td>
</tr>
<tr>
<td>Brave browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-brave-browser-credentials.png alt></td>
</tr>
<tr>
<td>Opera credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-opera-browser-credentials.png alt></td>
</tr>
<tr>
<td>Google Chrome credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-google-chrome-credentials.png alt></td>
</tr>
<tr>
<td>7 Star browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-7-star-browser-credentials.png alt></td>
</tr>
<tr>
<td>Amigo browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-amigo-browser-credentials.png alt></td>
</tr>
<tr>
<td>Cent browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-cent-browser-credentials.png alt></td>
</tr>
<tr>
<td>Chedot browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-chedot-browser-credentials.png alt></td>
</tr>
<tr>
<td>Google chrome SxS credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-google-chrome-sxs-credentials.png alt></td>
</tr>
<tr>
<td>Chromium credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-chromium-credentials.png alt></td>
</tr>
<tr>
<td>CocCoc browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-coccoc-browser-credentials.png alt></td>
</tr>
<tr>
<td>Comodo browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-comodo-credentials.png alt></td>
</tr>
<tr>
<td>Elements browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-elements-browser-credentials.png alt></td>
</tr>
<tr>
<td>Epic Privacy browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-epic-privacy-browser-credentials.png alt></td>
</tr>
<tr>
<td>Kometa browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-kometa-browser-credentials.png alt></td>
</tr>
<tr>
<td>Orbitum browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-orbitum-browser-credentials.png alt></td>
</tr>
<tr>
<td>Sputnik browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-sputnik-browser-credentials.png alt></td>
</tr>
<tr>
<td>Torch browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-torch-browser-credentials.png alt></td>
</tr>
<tr>
<td>Ucoz Media Uran browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-ucoz-media-browser-credentials.png alt></td>
</tr>
<tr>
<td>Vivaldi browser credentials</td>
<td><img src=/posts/malware-face-brain-credential-stealer/evidence-vivaldi-browser-credentials.png alt></td>
</tr>
</tbody>
</table>
<h2 id=calling-home>
Calling home
<a class=heading-link href=#calling-home>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>Once all the credentials are collected, it sends it back to a server from a Lithuanian hosting provider that is a <a href=https://cleantalk.org/blacklists/as61272>known spam hoster</a>.</p>
<p><img src=/posts/malware-face-brain-credential-stealer/call-home.png alt="Calls home"></p>
<h1 id=conclusion>
Conclusion
<a class=heading-link href=#conclusion>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>This is a fairly comphrensive stealer in terms of browsers, and it&rsquo;s certainly very well obfuscated. However, it doesn&rsquo;t detect its environment well. The anti-vm can be easily defeated, and it doesn&rsquo;t even check for debuggers, nor analysis tools such as procmon.</p>
</div>
<footer>
<script src=https://utteranc.es/client.js repo=brianstadnicki/brianstadnicki.github.io issue-term=pathname label theme=preferred-color-scheme crossorigin=anonymous async></script>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
<p>Education through a 1000 mistakes</p>
©
2021 -
2022
Brian Stadnicki
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
<script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "f5dd1cc794e748f0a1fa431f62434694"}'></script>
</body>
</html>