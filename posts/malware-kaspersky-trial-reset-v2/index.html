<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Analysis of Kasperky Trial Reset V2 - Brian Stadnicki</title><meta name=Description content><meta property="og:title" content="Analysis of Kasperky Trial Reset V2"><meta property="og:description" content="I&rsquo;ve picked this sample from any.run. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.
   Property Value     File Type Portable Executable 32   File Size 862.00 KB   FileTitle Kasperky Trial Reset   FileDescription Protected with AzeFuscator Extended   FileVersion 1,0,0,0   ProductName Protectd with AzeFuscator Extended   MD5 d56e6af4d2f9170cf312f110f3fa8511   SHA1 1e5be78908b38b9c6e7d6593888e355ee270a6c2   SHA256 aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433    Loader analysis The loader is very simple, just some misc methods along with a call to CreateProcessA, and the imports fopen, fwrite and fclose, which are used for writing the unpacked executable to the disk."><meta property="og:type" content="article"><meta property="og:url" content="https://brianstadnicki.github.io/posts/malware-kaspersky-trial-reset-v2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-21T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Analysis of Kasperky Trial Reset V2"><meta name=twitter:description content="I&rsquo;ve picked this sample from any.run. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.
   Property Value     File Type Portable Executable 32   File Size 862.00 KB   FileTitle Kasperky Trial Reset   FileDescription Protected with AzeFuscator Extended   FileVersion 1,0,0,0   ProductName Protectd with AzeFuscator Extended   MD5 d56e6af4d2f9170cf312f110f3fa8511   SHA1 1e5be78908b38b9c6e7d6593888e355ee270a6c2   SHA256 aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433    Loader analysis The loader is very simple, just some misc methods along with a call to CreateProcessA, and the imports fopen, fwrite and fclose, which are used for writing the unpacked executable to the disk."><meta name=application-name content="Brian Stadnicki"><meta name=apple-mobile-web-app-title content="Brian Stadnicki"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://brianstadnicki.github.io/posts/malware-kaspersky-trial-reset-v2/><link rel=prev href=https://brianstadnicki.github.io/posts/tips-net-resource-assemblies/><link rel=next href=https://brianstadnicki.github.io/posts/htb-challenge-93/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Analysis of Kasperky Trial Reset V2","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/brianstadnicki.github.io\/posts\/malware-kaspersky-trial-reset-v2\/"},"genre":"posts","keywords":"reverse engineering, malware, x86, trojan, rat, .NET","wordcount":355,"url":"https:\/\/brianstadnicki.github.io\/posts\/malware-kaspersky-trial-reset-v2\/","datePublished":"2021-11-21T00:00:00+00:00","dateModified":"2021-11-21T00:00:00+00:00","publisher":{"@type":"Organization","name":"Brian Stadnicki"},"author":{"@type":"Person","name":"Brian Stadnicki"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":''==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:''==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/resume.pdf>Resume </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/resume.pdf title>Resume</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Analysis of Kasperky Trial Reset V2</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Brian Stadnicki</a></span>&nbsp;<span class=post-category>included in <a href=/categories/malware-analysis/><i class="far fa-folder fa-fw"></i>malware analysis</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-11-21>2021-11-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;355 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#loader-analysis>Loader analysis</a></li><li><a href=#ratexe>Rat.exe</a><ul><li><a href=#main>Main</a><ul><li><a href=#initialize-settings>Initialize settings</a></li></ul></li></ul></li><li><a href=#google-fu>Google-Fu</a></li></ul></nav></div></div><div class=content id=content><p>I&rsquo;ve picked this sample from <a href=https://app.any.run/tasks/e7f4b3b9-4709-49ff-ae50-d44d9c61d31e/ target=_blank rel="noopener noreffer">any.run</a>. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.</p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>File Type</td><td>Portable Executable 32</td></tr><tr><td>File Size</td><td>862.00 KB</td></tr><tr><td>FileTitle</td><td>Kasperky Trial Reset</td></tr><tr><td>FileDescription</td><td>Protected with AzeFuscator Extended</td></tr><tr><td>FileVersion</td><td>1,0,0,0</td></tr><tr><td>ProductName</td><td>Protectd with AzeFuscator Extended</td></tr><tr><td>MD5</td><td>d56e6af4d2f9170cf312f110f3fa8511</td></tr><tr><td>SHA1</td><td>1e5be78908b38b9c6e7d6593888e355ee270a6c2</td></tr><tr><td>SHA256</td><td>aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433</td></tr></tbody></table><h2 id=loader-analysis>Loader analysis</h2><p>The loader is very simple, just some misc methods along with a call to <code>CreateProcessA</code>, and the imports <code>fopen</code>, <code>fwrite</code> and <code>fclose</code>, which are used for writing the unpacked executable to the disk.</p><p>To unpack, use x32dbg and set a breakpoint at <code>fclose</code> to figure out what the file written is. Looking at the stack, the file is <code>C:\\Users\\IEUser\\Rat.exe</code>. Nice naming.</p><h2 id=ratexe>Rat.exe</h2><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>File Type</td><td>Portable Executable 32 .NET Assembly</td></tr><tr><td>File Info</td><td>Microsoft Visual Studio .NET</td></tr><tr><td>File Size</td><td>45.00 KB</td></tr><tr><td>InternalName</td><td>Stub.exe</td></tr><tr><td>OriginalFilename</td><td>Stub.exe</td></tr><tr><td>FileVersion</td><td>1.0.0.0</td></tr><tr><td>ProductVersion</td><td>1.0.0.0</td></tr><tr><td>MD5</td><td>92AE00718AABC2B102C2917365C99B23</td></tr><tr><td>SHA1</td><td>510E02707867F1B3FB2C3A422E6B38E41D30437E</td></tr><tr><td>SHA256</td><td>3BE8B9FB6DF8453B6E00EB7A801A6D407C28AF3E20FABEEA794A5D455C29338F</td></tr></tbody></table><p>There&rsquo;s no obfuscation, so analysing this is going to be easy.</p><h3 id=main>Main</h3><p>The main program flow is as follows:</p><ul><li>Initalize settings</li><li>Create a mutex</li><li>Check for analysis tools</li><li>Install self</li><li>Set process as critical</li><li>Connect to Command & Control server</li></ul><h4 id=initialize-settings>Initialize settings</h4><p>There is a tiny bit of protection for the settings, in that it decodes the AES256 key from a base64 string, and then uses that to decrypt all the rest of the settings which are encoded with base64. Hwid is generated dynamically.</p><table><thead><tr><th>Setting</th><th>Value</th></tr></thead><tbody><tr><td>Key</td><td>BLUcOMq3ucrufspIr5POSfDA96qjRUPR</td></tr><tr><td>Ports</td><td>6606,7707,8808</td></tr><tr><td>Hosts</td><td>127.0.0.1</td></tr><tr><td>Version</td><td>0.5.7B</td></tr><tr><td>Install</td><td>false</td></tr><tr><td>MTX</td><td>AsyncMutex_6SI8OkPnk</td></tr><tr><td>Pastebin</td><td>null</td></tr><tr><td>Anti</td><td>false</td></tr><tr><td>BDOS</td><td>false</td></tr><tr><td>Group</td><td>Default</td></tr><tr><td>Hwid</td><td>DC10896CF40D0635B440</td></tr><tr><td>Serversignature</td><td>VTrzri8Fl6zfx/omWVmRhIu+LLjs6OKqDxi6j/0QAv0/YX2SVSaMjb2u5rICDgkZTicxYTZ0eNmaoDtHLTa2uCWHUckxtZ3PsxBiyZHwLFo2tsYp2wuibpoyuLDgHJ+tK8oaC09AJhyXls4UninTwn3w4z7+AuWpZl0lgZ87khGbPDJ1sOIz7ZFRiSUP21p3866S+2eJjCVuEYjQ0PNpddeFpEGSLolfdTuAOum/Yc7dusCTwuUfJPC0sgcIosWAIOttcilVe7c51beXh8uSiZUHeNH+sN+ZjZqATV3FnlPRCSHWIobXIk5PSDfj/s6sVtBWkX3NR+ACYrBjmPTIVEjodi7X8JlPwZvNMPsRTH9JuSgaa9XsqbtRpvE5U1llA7xPimqYXIjK0L8uEtFQbwOy9wQXuB21u8ffhcPnXQo6UJDz/gWAFlrYKml9NowRS/EqZnYs4X5KsLfBbiWTyit7X6NQVsiig2qRkzizDBmTkUu44ZMxVnvZirzPTX4nKvk40m7hIfoyNDwhRDvSD3JS+wwkjIcP06bw4vJVujT//S2JlKMb/nrJNmg4m/U+U2HrXoxbyANrHgzRP8a/D557pnpqsCYpqNk0+4E/1Y+Rik9P1wKAUvnmlHL5DvChMWpnQyazyeuk2GEV2MUhPPlfGkQBBLAv35LBHBCogAY=</td></tr><tr><td>ServerCertificate</td><td>[Subject] CN=AsyncRAT Server [Issuer] CN=AsyncRAT Server [Serial Number] 008A0F28638731BC6F8AB2EC30DF3E57 [Not Before] 11/09/2021 17:14:37 [Not After] 31/12/9999 23:59:59 [Thumbprint] 919ED7E49AB16C2CE27573AAC646842333163461</td></tr></tbody></table><h2 id=google-fu>Google-Fu</h2><p>Googling is very important, try to check out what an interesting might be. The server certificate is of <code>AsyncRAT Server</code>, and the version is <code>0.5.7B</code>. A bit of googling shows that this is simply an open source project, where the malware author forgot to configure the server address from <code>127.0.0.1</code> or was testing it.</p><p>You can view the specific version of the open source version on <a href=https://github.com/NYAN-x-CAT/AsyncRAT-C-Sharp/tree/5937e381f9569f2568c5fcc6c00c99cbb8198805 target=_blank rel="noopener noreffer">github</a>.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-11-21</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/reverse-engineering/>reverse engineering</a>,&nbsp;<a href=/tags/malware/>malware</a>,&nbsp;<a href=/tags/x86/>x86</a>,&nbsp;<a href=/tags/trojan/>trojan</a>,&nbsp;<a href=/tags/rat/>rat</a>,&nbsp;<a href=/tags/.net/>.NET</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/tips-net-resource-assemblies/ class=prev rel=prev title="Modifying .NET embedded resources"><i class="fas fa-angle-left fa-fw"></i>Modifying .NET embedded resources</a>
<a href=/posts/htb-challenge-93/ class=next rel=next title="HTB forensics challenge: oBfsC4t10n #93">HTB forensics challenge: oBfsC4t10n #93<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.94.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "f5dd1cc794e748f0a1fa431f62434694"}'></script></body></html>