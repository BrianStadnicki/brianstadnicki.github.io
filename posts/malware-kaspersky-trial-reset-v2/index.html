<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' utteranc.es; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' utteranc.es static.cloudflareinsights.com; prefetch-src 'self'; connect-src 'self' cloudflareinsights.com;">
<meta name=author content="Brian Stadnicki">
<meta name=description content="I&rsquo;ve picked this sample from any.run. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.
   Property Value     File Type Portable Executable 32   File Size 862.00 KB   FileTitle Kasperky Trial Reset   FileDescription Protected with AzeFuscator Extended   FileVersion 1,0,0,0   ProductName Protectd with AzeFuscator Extended   MD5 d56e6af4d2f9170cf312f110f3fa8511   SHA1 1e5be78908b38b9c6e7d6593888e355ee270a6c2   SHA256 aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433    Loader analysis    The loader is very simple, just some misc methods along with a call to CreateProcessA, and the imports fopen, fwrite and fclose, which are used for writing the unpacked executable to the disk.">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Analysis of Kasperky Trial Reset V2">
<meta name=twitter:description content="I&rsquo;ve picked this sample from any.run. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.
   Property Value     File Type Portable Executable 32   File Size 862.00 KB   FileTitle Kasperky Trial Reset   FileDescription Protected with AzeFuscator Extended   FileVersion 1,0,0,0   ProductName Protectd with AzeFuscator Extended   MD5 d56e6af4d2f9170cf312f110f3fa8511   SHA1 1e5be78908b38b9c6e7d6593888e355ee270a6c2   SHA256 aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433    Loader analysis    The loader is very simple, just some misc methods along with a call to CreateProcessA, and the imports fopen, fwrite and fclose, which are used for writing the unpacked executable to the disk.">
<meta property="og:title" content="Analysis of Kasperky Trial Reset V2">
<meta property="og:description" content="I&rsquo;ve picked this sample from any.run. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.
   Property Value     File Type Portable Executable 32   File Size 862.00 KB   FileTitle Kasperky Trial Reset   FileDescription Protected with AzeFuscator Extended   FileVersion 1,0,0,0   ProductName Protectd with AzeFuscator Extended   MD5 d56e6af4d2f9170cf312f110f3fa8511   SHA1 1e5be78908b38b9c6e7d6593888e355ee270a6c2   SHA256 aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433    Loader analysis    The loader is very simple, just some misc methods along with a call to CreateProcessA, and the imports fopen, fwrite and fclose, which are used for writing the unpacked executable to the disk.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://brianstadnicki.github.io/posts/malware-kaspersky-trial-reset-v2/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-21T00:00:00+00:00">
<meta property="article:modified_time" content="2021-11-21T00:00:00+00:00">
<title>
Analysis of Kasperky Trial Reset V2 · Brian Stadnicki
</title>
<link rel=canonical href=https://brianstadnicki.github.io/posts/malware-kaspersky-trial-reset-v2/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.92.0">
</head>
<body class="preload-transitions colorscheme-light">
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Brian Stadnicki
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/about/>About</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/resume.pdf>Resume</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/contact/>Contact me</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=https://brianstadnicki.github.io/posts/malware-kaspersky-trial-reset-v2/>
Analysis of Kasperky Trial Reset V2
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-11-21T00:00:00Z>
21 November, 2021
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read
</span>
</div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/malware-analysis/>malware analysis</a></div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/reverse-engineering/>reverse engineering</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/malware/>malware</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/x86/>x86</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/trojan/>trojan</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/rat/>rat</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/.net/>.NET</a>
</span></div>
</div>
</header>
<div>
<p>I&rsquo;ve picked this sample from <a href=https://app.any.run/tasks/e7f4b3b9-4709-49ff-ae50-d44d9c61d31e/>any.run</a>. It appears to be a trojan tricking people who can&rsquo;t afford Kasperky with a RAT, with the kasperky logo to match.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Type</td>
<td>Portable Executable 32</td>
</tr>
<tr>
<td>File Size</td>
<td>862.00 KB</td>
</tr>
<tr>
<td>FileTitle</td>
<td>Kasperky Trial Reset</td>
</tr>
<tr>
<td>FileDescription</td>
<td>Protected with AzeFuscator Extended</td>
</tr>
<tr>
<td>FileVersion</td>
<td>1,0,0,0</td>
</tr>
<tr>
<td>ProductName</td>
<td>Protectd with AzeFuscator Extended</td>
</tr>
<tr>
<td>MD5</td>
<td>d56e6af4d2f9170cf312f110f3fa8511</td>
</tr>
<tr>
<td>SHA1</td>
<td>1e5be78908b38b9c6e7d6593888e355ee270a6c2</td>
</tr>
<tr>
<td>SHA256</td>
<td>aef7cef69eb5e31673d034239aff208061fa61e8b5c8355b933e14f5818e4433</td>
</tr>
</tbody>
</table>
<h1 id=loader-analysis>
Loader analysis
<a class=heading-link href=#loader-analysis>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>The loader is very simple, just some misc methods along with a call to <code>CreateProcessA</code>, and the imports <code>fopen</code>, <code>fwrite</code> and <code>fclose</code>, which are used for writing the unpacked executable to the disk.</p>
<p>To unpack, use x32dbg and set a breakpoint at <code>fclose</code> to figure out what the file written is. Looking at the stack, the file is <code>C:\\Users\\IEUser\\Rat.exe</code>. Nice naming.</p>
<h1 id=ratexe>
Rat.exe
<a class=heading-link href=#ratexe>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>File Type</td>
<td>Portable Executable 32 .NET Assembly</td>
</tr>
<tr>
<td>File Info</td>
<td>Microsoft Visual Studio .NET</td>
</tr>
<tr>
<td>File Size</td>
<td>45.00 KB</td>
</tr>
<tr>
<td>InternalName</td>
<td>Stub.exe</td>
</tr>
<tr>
<td>OriginalFilename</td>
<td>Stub.exe</td>
</tr>
<tr>
<td>FileVersion</td>
<td>1.0.0.0</td>
</tr>
<tr>
<td>ProductVersion</td>
<td>1.0.0.0</td>
</tr>
<tr>
<td>MD5</td>
<td>92AE00718AABC2B102C2917365C99B23</td>
</tr>
<tr>
<td>SHA1</td>
<td>510E02707867F1B3FB2C3A422E6B38E41D30437E</td>
</tr>
<tr>
<td>SHA256</td>
<td>3BE8B9FB6DF8453B6E00EB7A801A6D407C28AF3E20FABEEA794A5D455C29338F</td>
</tr>
</tbody>
</table>
<p>There&rsquo;s no obfuscation, so analysing this is going to be easy.</p>
<h2 id=main>
Main
<a class=heading-link href=#main>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>The main program flow is as follows:</p>
<ul>
<li>Initalize settings</li>
<li>Create a mutex</li>
<li>Check for analysis tools</li>
<li>Install self</li>
<li>Set process as critical</li>
<li>Connect to Command & Control server</li>
</ul>
<h3 id=initialize-settings>
Initialize settings
<a class=heading-link href=#initialize-settings>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h3>
<p>There is a tiny bit of protection for the settings, in that it decodes the AES256 key from a base64 string, and then uses that to decrypt all the rest of the settings which are encoded with base64. Hwid is generated dynamically.</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Key</td>
<td>BLUcOMq3ucrufspIr5POSfDA96qjRUPR</td>
</tr>
<tr>
<td>Ports</td>
<td>6606,7707,8808</td>
</tr>
<tr>
<td>Hosts</td>
<td>127.0.0.1</td>
</tr>
<tr>
<td>Version</td>
<td>0.5.7B</td>
</tr>
<tr>
<td>Install</td>
<td>false</td>
</tr>
<tr>
<td>MTX</td>
<td>AsyncMutex_6SI8OkPnk</td>
</tr>
<tr>
<td>Pastebin</td>
<td>null</td>
</tr>
<tr>
<td>Anti</td>
<td>false</td>
</tr>
<tr>
<td>BDOS</td>
<td>false</td>
</tr>
<tr>
<td>Group</td>
<td>Default</td>
</tr>
<tr>
<td>Hwid</td>
<td>DC10896CF40D0635B440</td>
</tr>
<tr>
<td>Serversignature</td>
<td>VTrzri8Fl6zfx/omWVmRhIu+LLjs6OKqDxi6j/0QAv0/YX2SVSaMjb2u5rICDgkZTicxYTZ0eNmaoDtHLTa2uCWHUckxtZ3PsxBiyZHwLFo2tsYp2wuibpoyuLDgHJ+tK8oaC09AJhyXls4UninTwn3w4z7+AuWpZl0lgZ87khGbPDJ1sOIz7ZFRiSUP21p3866S+2eJjCVuEYjQ0PNpddeFpEGSLolfdTuAOum/Yc7dusCTwuUfJPC0sgcIosWAIOttcilVe7c51beXh8uSiZUHeNH+sN+ZjZqATV3FnlPRCSHWIobXIk5PSDfj/s6sVtBWkX3NR+ACYrBjmPTIVEjodi7X8JlPwZvNMPsRTH9JuSgaa9XsqbtRpvE5U1llA7xPimqYXIjK0L8uEtFQbwOy9wQXuB21u8ffhcPnXQo6UJDz/gWAFlrYKml9NowRS/EqZnYs4X5KsLfBbiWTyit7X6NQVsiig2qRkzizDBmTkUu44ZMxVnvZirzPTX4nKvk40m7hIfoyNDwhRDvSD3JS+wwkjIcP06bw4vJVujT//S2JlKMb/nrJNmg4m/U+U2HrXoxbyANrHgzRP8a/D557pnpqsCYpqNk0+4E/1Y+Rik9P1wKAUvnmlHL5DvChMWpnQyazyeuk2GEV2MUhPPlfGkQBBLAv35LBHBCogAY=</td>
</tr>
<tr>
<td>ServerCertificate</td>
<td>[Subject] CN=AsyncRAT Server [Issuer] CN=AsyncRAT Server [Serial Number] 008A0F28638731BC6F8AB2EC30DF3E57 [Not Before] 11/09/2021 17:14:37 [Not After] 31/12/9999 23:59:59 [Thumbprint] 919ED7E49AB16C2CE27573AAC646842333163461</td>
</tr>
</tbody>
</table>
<h1 id=google-fu>
Google-Fu
<a class=heading-link href=#google-fu>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>Googling is very important, try to check out what an interesting might be. The server certificate is of <code>AsyncRAT Server</code>, and the version is <code>0.5.7B</code>. A bit of googling shows that this is simply an open source project, where the malware author forgot to configure the server address from <code>127.0.0.1</code> or was testing it.</p>
<p>You can view the specific version of the open source version on <a href=https://github.com/NYAN-x-CAT/AsyncRAT-C-Sharp/tree/5937e381f9569f2568c5fcc6c00c99cbb8198805>github</a>.</p>
</div>
<footer>
<script src=https://utteranc.es/client.js repo=brianstadnicki/brianstadnicki.github.io issue-term=pathname label theme=preferred-color-scheme crossorigin=anonymous async></script>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
<p>Education through a 1000 mistakes</p>
©
2021 -
2022
Brian Stadnicki
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
<script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "f5dd1cc794e748f0a1fa431f62434694"}'></script>
</body>
</html>